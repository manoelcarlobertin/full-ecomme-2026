<div class="bg-zinc-50 dark:bg-zinc-900 min-h-screen py-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-zinc-900 dark:text-white mb-8">Meu Carrinho</h1>

    <% if @cart_products.any? %>
      <div class="lg:grid lg:grid-cols-12 lg:gap-x-12 lg:items-start xl:gap-x-16">

        <section class="lg:col-span-7">
          <ul role="list" class="border-t border-b border-zinc-200 dark:border-zinc-700 divide-y divide-zinc-200 dark:divide-zinc-700">
            <% @cart_products.each do |product| %>
              <li id="cart_item_<%= product.id %>" class="flex py-6 sm:py-10">
                <div class="flex-shrink-0">
                  <% if product.image.attached? %>
                    <%= image_tag product.image, class: "h-24 w-24 rounded-md object-cover object-center sm:h-48 sm:w-48" %>
                  <% else %>
                    <div class="h-24 w-24 rounded-md bg-zinc-200 dark:bg-zinc-800 flex items-center justify-center">ðŸŽ®</div>
                  <% end %>
                </div>

                <div class="ml-4 flex-1 flex flex-col justify-between sm:ml-6">
                  <div class="relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0">
                    <div>
                      <div class="flex justify-between">
                        <h3 class="text-sm">
                          <a href="#" class="font-medium text-zinc-700 dark:text-zinc-200 hover:text-zinc-800">
                            <%= product.name %>
                            <% if product.productable_type == "Game" && product.productable.present? %>
                              <% game = product.productable %>

                              <div class="mt-3 space-y-2">
                                <div class="flex flex-wrap gap-2 text-xs">
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300">
                                    <%= game.developer %>
                                  </span>
                                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                                    <%= game.mode&.humanize %>
                                  </span>
                                  <span class="text-zinc-500 dark:text-zinc-400 self-center">
                                    LanÃ§amento: <%= l(game.release_date, format: :long) if game.release_date %>
                                  </span>
                                </div>
                              </div>
                            <% end %>
                          </a>
                        </h3>
                      </div>

                      <p class="mt-2 text-sm text-zinc-500 dark:text-zinc-400 line-clamp-2" title="<%= product.description %>">
                        <%= truncate(product.description, length: 140) %>
                      </p>

                      <% if product.productable_type == "Game" && product.productable&.system_requirement %>
                        <% sys = product.productable.system_requirement %>

                        <div class="mt-3 bg-zinc-100 dark:bg-zinc-800/50 p-3 rounded-lg border border-zinc-200 dark:border-zinc-700">
                          <p class="text-xs font-semibold text-zinc-900 dark:text-zinc-300 mb-1">Requisitos MÃ­nimos:</p>
                          <div class="grid grid-cols-1 gap-x-4 gap-y-1 text-xs text-zinc-600 dark:text-zinc-400">
                            <div>
                              <span class="font-medium text-zinc-500">SO:</span> <%= sys.operational_system %>
                            </div>
                            <div>
                              <span class="font-medium text-zinc-500">RAM:</span> <%= sys.memory %>
                            </div>
                            <div class="col-span-2 truncate" title="<%= sys.video_board %>">
                              <span class="font-medium text-zinc-500">GPU:</span> <%= sys.video_board %>
                            </div>
                            <div class="col-span-2 truncate" title="<%= sys.processor %>">
                              <span class="font-medium text-zinc-500">CPU:</span> <%= sys.processor %>
                            </div>
                          </div>
                        </div>
                      <% end %>

                      <div class="mt-1 flex text-sm">
                        <p class="text-zinc-500 dark:text-zinc-400">Digital Key</p>
                      </div>

                      <p class="mt-1 text-sm font-medium text-zinc-900 dark:text-white">
                        <%= number_to_currency(product.price, unit: "R$ ", separator: ",", delimiter: ".") %>
                      </p>
                    </div>

                    <div class="mt-4 sm:mt-0 sm:pr-9">
                      <div class="absolute top-0 right-0">
                        <%= button_to remove_from_cart_path(product_id: product.id), method: :delete, class: "-m-2 p-2 inline-flex text-zinc-400 hover:text-red-500 transition" do %>
                          <span class="sr-only">Remover</span>
                          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                          </svg>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </section>

        <section class="mt-16 bg-white dark:bg-zinc-800 rounded-lg px-4 py-6 sm:p-6 lg:p-8 lg:mt-0 lg:col-span-5 shadow-lg border border-zinc-200 dark:border-zinc-700">
          <h2 class="text-lg font-medium text-zinc-900 dark:text-white">Resumo do Pedido</h2>

          <dl class="mt-6 space-y-4">
            <div class="flex items-center justify-between border-t border-zinc-200 dark:border-zinc-600 pt-4">
              <dt class="text-base font-medium text-zinc-900 dark:text-white">Total</dt>
              <%= render "cart/total", total: @total_value %>
            </div>
          </dl>

          <div class="mt-6">
            <%= button_to "Finalizar Compra", checkout_path, 
                method: :post, 
                class: "w-full bg-blue-600 border border-transparent rounded-md shadow-sm py-3 px-4 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 focus:ring-offset-zinc-50 dark:focus:ring-offset-zinc-900 transition text-center cursor-pointer",
                data: { turbo: false } # Desativamos o turbo aqui para garantir o redirect completo
            %>
          </div>

          <div class="mt-4 text-center">
            <%= link_to "Continuar Comprando", root_path, class: "text-sm text-blue-500 hover:text-blue-400 font-medium" %>
          </div>
        </section>
      </div>
    <% else %>
    <div class="text-center py-20">
      <svg class="mx-auto h-12 w-12 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
      </svg>
      <h3 class="mt-2 text-sm font-medium text-zinc-900 dark:text-white">Carrinho vazio</h3>
      <p class="mt-1 text-sm text-zinc-500 dark:text-zinc-400">Comece a adicionar jogos incrÃ­veis agora.</p>
      <div class="mt-6">
        <%= link_to "Ir para a Loja", root_path, class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700" %>
      </div>
    </div>
    <% end %>
  </div>
</div>